<!-- templates/courses.html -->
{% extends "base.html" %}

{% block title %}All Courses - CostByte AI-Powered Learning Platform{% endblock %}

{% block content %}
<!-- Courses Header -->
<section class="courses-header">
    <div class="container">
        <div class="header-content">
            <h1>Explore Our <span class="highlight">AI-Powered Courses</span></h1>
            <p class="header-subtitle">Choose from cutting-edge courses designed to boost your career and income</p>
            
            <!-- Search and Filter -->
            <div class="courses-controls">
                <div class="search-box">
                    <input type="text" id="courseSearch" placeholder="Search courses..." onkeyup="filterCourses()">
                    <span class="search-icon">üîç</span>
                </div>
                
                <div class="filter-controls">
                    <select id="categoryFilter" onchange="filterCourses()">
                        <option value="">All Categories</option>
                        <option value="ai">AI & Machine Learning</option>
                        <option value="programming">Programming</option>
                        <option value="data-science">Data Science</option>
                        <option value="marketing">Digital Marketing</option>
                        <option value="business">Business & Finance</option>
                    </select>
                    
                    <select id="difficultyFilter" onchange="filterCourses()">
                        <option value="">All Levels</option>
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                    
                    <select id="sortFilter" onchange="sortCourses()">
                        <option value="popular">Most Popular</option>
                        <option value="newest">Newest</option>
                        <option value="rating">Highest Rated</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Courses Grid -->
<section class="all-courses">
    <div class="container">
        <!-- Results Info -->
        <div class="results-info">
            <span id="resultsCount">{{ courses|length }} courses available</span>
            <div class="view-controls">
                <button class="view-btn active" onclick="setGridView()">Grid</button>
                <button class="view-btn" onclick="setListView()">List</button>
            </div>
        </div>

        <!-- Courses Grid -->
        <div class="courses-container grid-view" id="coursesContainer">
            {% for course in courses %}
            <div class="course-card" data-category="{{ course.category|lower }}" data-difficulty="{{ course.difficulty }}" data-rating="{{ course.total_rating or 4.8 }}">
                <!-- Course Badges -->
                <div class="course-badges">
                    {% if course.is_featured %}
                    <div class="course-badge featured">FEATURED</div>
                    {% endif %}
                    <div class="course-badge ai-powered">AI POWERED</div>
                    {% if course.difficulty == 'beginner' %}
                    <div class="course-badge beginner">BEGINNER FRIENDLY</div>
                    {% endif %}
                </div>

                <!-- Course Image -->
                <div class="course-image">
                    <img src="{{ course.image_url or '/static/images/course-placeholder.jpg' }}" 
                         alt="{{ course.title }}" 
                         loading="lazy">
                    <div class="course-overlay">
                        <button class="preview-button" onclick="previewCourse('{{ course.id }}')">
                            Quick Preview
                        </button>
                        <button class="wishlist-button" onclick="toggleWishlist('{{ course.id }}')">
                            ‚ô°
                        </button>
                    </div>
                </div>

                <!-- Course Content -->
                <div class="course-content">
                    <div class="course-category">{{ course.category }}</div>
                    <h3 class="course-title">{{ course.title }}</h3>
                    <p class="course-description">{{ course.short_description or course.description[:120] ~ '...' }}</p>

                    <!-- Instructor Info -->
                    <div class="instructor-info">
                        <div class="instructor-avatar">AI</div>
                        <div class="instructor-details">
                            <strong>AI Instructor</strong>
                            <span>CostByte AI System</span>
                        </div>
                    </div>

                    <!-- Course Metrics -->
                    <div class="course-metrics">
                        <div class="metric">
                            <span class="metric-icon">‚è±Ô∏è</span>
                            {{ course.duration_hours }}h
                        </div>
                        <div class="metric">
                            <span class="metric-icon">üìä</span>
                            {{ course.difficulty|title }}
                        </div>
                        <div class="metric">
                            <span class="metric-icon">üë•</span>
                            {{ course.total_students or 1200 }}+
                        </div>
                        <div class="metric rating">
                            <span class="metric-icon">‚≠ê</span>
                            {{ "%.1f"|format(course.total_rating or 4.8) }}
                        </div>
                    </div>

                    <!-- Learning Outcomes -->
                    <div class="learning-outcomes">
                        <strong>What you'll achieve:</strong>
                        <ul>
                            <li>Master {{ course.category }} fundamentals</li>
                            <li>Build practical projects</li>
                            <li>Develop income-generating skills</li>
                        </ul>
                    </div>

                    <!-- Pricing -->
                    <div class="pricing-section">
                        <div class="price-container">
                            {% if course.original_price_zar %}
                            <div class="original-price">R{{ "%.0f"|format(course.original_price_zar) }}</div>
                            {% endif %}
                            <div class="current-price">R{{ "%.0f"|format(course.price_zar) }}</div>
                            <div class="discount-badge">
                                {% if course.original_price_zar %}
                                Save {{ ((1 - course.price_zar / course.original_price_zar) * 100)|int }}%
                                {% else %}
                                Special Offer
                                {% endif %}
                            </div>
                        </div>
                        <div class="pricing-note">
                            One-time payment ‚Ä¢ Lifetime access
                        </div>
                    </div>

                    <!-- CTA Button -->
                    <button class="enroll-button" onclick="showCourseModal('{{ course.id }}')">
                        <span class="button-icon">üöÄ</span>
                        Enroll Now
                    </button>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="action-btn" onclick="addToCompare('{{ course.id }}')">
                            üìä Compare
                        </button>
                        <button class="action-btn" onclick="shareCourse('{{ course.id }}')">
                            üì§ Share
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Load More -->
        <div class="load-more-section">
            <button class="load-more-btn" onclick="loadMoreCourses()">
                Load More Courses
            </button>
        </div>

        <!-- No Results Message -->
        <div class="no-results" id="noResults" style="display: none;">
            <div class="no-results-content">
                <h3>No courses found</h3>
                <p>Try adjusting your search or filters</p>
                <button class="btn-primary" onclick="clearFilters()">Clear All Filters</button>
            </div>
        </div>
    </div>
</section>

<!-- Categories Section -->
<section class="categories-section">
    <div class="container">
        <div class="section-header">
            <h2>Browse by <span class="highlight">Category</span></h2>
            <p class="section-subtitle">Find the perfect course for your career goals</p>
        </div>

        <div class="categories-grid">
            <div class="category-card" onclick="filterByCategory('ai')">
                <div class="category-icon">ü§ñ</div>
                <h3>AI & Machine Learning</h3>
                <p>Master artificial intelligence, machine learning, and automation skills</p>
                <div class="course-count">12 courses</div>
            </div>

            <div class="category-card" onclick="filterByCategory('programming')">
                <div class="category-icon">üíª</div>
                <h3>Programming</h3>
                <p>Learn to code with Python, JavaScript, and modern development tools</p>
                <div class="course-count">8 courses</div>
            </div>

            <div class="category-card" onclick="filterByCategory('data-science')">
                <div class="category-icon">üìä</div>
                <h3>Data Science</h3>
                <p>Become a data analyst or scientist with practical data skills</p>
                <div class="course-count">6 courses</div>
            </div>

            <div class="category-card" onclick="filterByCategory('marketing')">
                <div class="category-icon">üì±</div>
                <h3>Digital Marketing</h3>
                <p>Master social media, SEO, and online marketing strategies</p>
                <div class="course-count">5 courses</div>
            </div>

            <div class="category-card" onclick="filterByCategory('business')">
                <div class="category-icon">üíº</div>
                <h3>Business & Finance</h3>
                <p>Learn entrepreneurship, investing, and business management</p>
                <div class="course-count">4 courses</div>
            </div>

            <div class="category-card" onclick="filterByCategory('all')">
                <div class="category-icon">üéØ</div>
                <h3>All Courses</h3>
                <p>Explore our complete catalog of AI-powered courses</p>
                <div class="course-count">35+ courses</div>
            </div>
        </div>
    </div>
</section>

<!-- Why Choose CostByte -->
<section class="why-choose">
    <div class="container">
        <div class="section-header">
            <h2>Why <span class="highlight">Choose CostByte?</span></h2>
        </div>

        <div class="features-grid">
            <div class="feature">
                <div class="feature-icon">ü§ñ</div>
                <h3>AI-Powered Learning</h3>
                <p>Personalized learning paths and AI mentorship for faster results</p>
            </div>

            <div class="feature">
                <div class="feature-icon">üíº</div>
                <h3>Career-Focused</h3>
                <p>Skills that employers actually want and pay premium salaries for</p>
            </div>

            <div class="feature">
                <div class="feature-icon">üîÑ</div>
                <h3>Lifetime Access</h3>
                <p>One-time payment for lifetime course access and all future updates</p>
            </div>

            <div class="feature">
                <div class="feature-icon">üë•</div>
                <h3>Community Support</h3>
                <p>Join thousands of successful students in our exclusive community</p>
            </div>

            <div class="feature">
                <div class="feature-icon">üéØ</div>
                <h3>Practical Projects</h3>
                <p>Build real portfolio projects that demonstrate your skills</p>
            </div>

            <div class="feature">
                <div class="feature-icon">üõ°Ô∏è</div>
                <h3>Risk-Free Guarantee</h3>
                <p>30-day money-back guarantee if you're not satisfied</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="courses-cta">
    <div class="container">
        <div class="cta-content">
            <h2>Ready to Start Your Learning Journey?</h2>
            <p>Join thousands of students transforming their careers with CostByte</p>
            <div class="cta-buttons">
                <button class="cta-button primary large" onclick="showEnrollmentModal()">
                    üöÄ Find Your Perfect Course
                </button>
                <a href="{{ url_for('chat_page') }}" class="cta-button secondary">
                    üí¨ Get Course Recommendations
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// Course filtering and search
function filterCourses() {
    const searchTerm = document.getElementById('courseSearch').value.toLowerCase();
    const categoryFilter = document.getElementById('categoryFilter').value;
    const difficultyFilter = document.getElementById('difficultyFilter').value;
    const courses = document.querySelectorAll('.course-card');
    let visibleCount = 0;

    courses.forEach(course => {
        const title = course.querySelector('.course-title').textContent.toLowerCase();
        const description = course.querySelector('.course-description').textContent.toLowerCase();
        const category = course.dataset.category;
        const difficulty = course.dataset.difficulty;

        const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
        const matchesCategory = !categoryFilter || category === categoryFilter;
        const matchesDifficulty = !difficultyFilter || difficulty === difficultyFilter;

        if (matchesSearch && matchesCategory && matchesDifficulty) {
            course.style.display = 'block';
            visibleCount++;
        } else {
            course.style.display = 'none';
        }
    });

    // Update results count
    document.getElementById('resultsCount').textContent = `${visibleCount} courses available`;
    
    // Show/hide no results message
    const noResults = document.getElementById('noResults');
    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
}

function sortCourses() {
    const sortBy = document.getElementById('sortFilter').value;
    const container = document.getElementById('coursesContainer');
    const courses = Array.from(container.querySelectorAll('.course-card'));

    courses.sort((a, b) => {
        switch (sortBy) {
            case 'newest':
                return new Date(b.dataset.created) - new Date(a.dataset.created);
            case 'rating':
                return parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating);
            case 'price-low':
                return getCoursePrice(a) - getCoursePrice(b);
            case 'price-high':
                return getCoursePrice(b) - getCoursePrice(a);
            case 'popular':
            default:
                return parseInt(b.dataset.students || 0) - parseInt(a.dataset.students || 0);
        }
    });

    // Reappend sorted courses
    courses.forEach(course => container.appendChild(course));
}

function getCoursePrice(courseElement) {
    const priceText = courseElement.querySelector('.current-price').textContent;
    return parseInt(priceText.replace(/[^0-9]/g, ''));
}

function filterByCategory(category) {
    document.getElementById('categoryFilter').value = category;
    filterCourses();
}

function clearFilters() {
    document.getElementById('courseSearch').value = '';
    document.getElementById('categoryFilter').value = '';
    document.getElementById('difficultyFilter').value = '';
    document.getElementById('sortFilter').value = 'popular';
    filterCourses();
}

// View controls
function setGridView() {
    const container = document.getElementById('coursesContainer');
    container.className = 'courses-container grid-view';
    document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
}

function setListView() {
    const container = document.getElementById('coursesContainer');
    container.className = 'courses-container list-view';
    document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
}

// Course actions
function toggleWishlist(courseId) {
    const button = event.target;
    button.textContent = button.textContent === '‚ô°' ? '‚ô•' : '‚ô°';
    button.classList.toggle('active');
    
    // In production, this would call an API
    fetch(`/api/wishlist/${courseId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    });
}

function addToCompare(courseId) {
    // In production, this would add to comparison list
    alert('Course added to comparison');
}

function shareCourse(courseId) {
    // In production, this would open share dialog
    if (navigator.share) {
        navigator.share({
            title: document.title,
            url: window.location.href
        });
    } else {
        alert('Share this course with friends!');
    }
}

function loadMoreCourses() {
    // In production, this would load more courses from API
    const button = event.target;
    button.innerHTML = 'Loading...';
    button.disabled = true;
    
    setTimeout(() => {
        alert('More courses would load here');
        button.innerHTML = 'Load More Courses';
        button.disabled = false;
    }, 1000);
}

// Initialize courses page
document.addEventListener('DOMContentLoaded', function() {
    // Add data attributes for sorting
    document.querySelectorAll('.course-card').forEach(course => {
        course.dataset.students = course.querySelector('.course-metrics .metric:nth-child(3)').textContent.replace(/[^0-9]/g, '');
        course.dataset.created = '2024-01-01'; // This would come from actual course data
    });
});
</script>
{% endblock %}
